### 防御式编程
#### 数据检查
- 检查外部的数据。
- 检查子程序的输入与输出。
- 处理异常输入数据。

#### 断言
- 通常只是开发阶段被编译，生产阶段并不编译。
- 不要把需求执行的代码放入断言。
- 用断言来处理绝不应该发生的状况，用错误处理代码来处理预期会发生的状况。
- 先使用断言，再处理错误。

#### 错误
- 使用中立值/平均值/常用值（0，'', []，{}等）。
- 使用上一个（如温度变化，游戏视频帧变化）/下一个（数据列表）正确的数据。
- 返回一个错误码或抛出异常，并把警告信息放入日志文件。
- 显示错误消息或者调用异常处理子程序，最坏的情况下退出程序。
- 如果底层只报告错误，高层一定要处理错误。
- 最重要的一点，整个项目要采用统一的约定方式处理错误。

#### 异常
- 异常是子程序把错误或者异常传递给调用代码处的一种特殊手段。
- 用异常通知程序的其他部分，发生了不可忽略的错误。
- 在恰当的抽象层次抛出恰当的异常，比如底层异常不应该在高层抽象中被抛出。
- 只有在错误处理不了的情况下才能抛出异常。与断言类似，都是处理罕见或者永久不会发生的情况。不要用异常来推卸责任。
- 异常消息应该包括导致异常发生的全部消息。
- 要了解依赖包所抛出的异常。
- 集中处理异常的地方。
- 最重要的一点，整个项目要采用统一的约定方式处理异常。
- 处理异常的最佳方法，就是释放所有资源并重启程序，让用户重新输入执行。

#### 隔离
可以让软件的某些部分（某个抽象层，公用方法等）处理“不干净的”数据，而让另一些部分处理“干净的”数据，即可让大部分代码无须再担负检查错误数据的职责。

#### 辅助调试
- 进攻式编程：
    在开发阶段应该把错误、异常显示出来。在产品代码运行时候可以自我修复。
    - 确保断言语句能终止运行。把问题引起的麻烦越大越好，这样才能修复。
    - 确保每个switch的default或者if的else都能产生严重错误并抛出。
    有时候，进攻的最好的防守。开发时候惨痛的失败，能让你在发布产品不会败的太惨。

- 使用编译器或者预处理器删除掉辅助调试代码

#### 保留防御式编程的原则
- 利用版本控制，预编译开关等根据环境来编译删除指定的防御式代码。
- 检查细微错误的代码，导致系统崩溃的代码应该删除。
- 可以适当的在异常情况下保留一些调试代码。
- 记录异常日志信息，并且在代码中的错误消息是友好的，如发生内部错误，然后留下邮箱与电话号码等反馈方式。

#### 防御式编程的危害
- 过度的防御式编程会让程序变得臃肿与缓慢。也增加软件复杂度。
- 开发者自己权宜使用防御式。
